{"ast":null,"code":"var _jsxFileName = \"D:\\\\OneDrive\\\\Little_Projects\\\\Param-Fitter\\\\frontend\\\\src\\\\pages\\\\Training.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef } from 'react';\nimport { Form, Button, message, Card, Upload } from 'antd';\nimport { UploadOutlined } from '@ant-design/icons';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Training = () => {\n  _s();\n  const [loading, setLoading] = useState(false);\n  const [trainingResult, setTrainingResult] = useState(null);\n  const selectedFileRef = useRef(null); // 选中的 Tag 文件\n  const [fileName, setFileName] = useState(null);\n\n  /** 点击“开始训练” */\n  const onTrain = async () => {\n    const fileObj = selectedFileRef.current;\n    if (!fileObj) {\n      message.error('请先上传 Tag 文件');\n      return;\n    }\n    setLoading(true);\n    try {\n      /* ---------- 1. 读取文件内容 (UTF-16LE → JSON) ---------- */\n      const buffer = await fileObj.arrayBuffer(); // 读成 ArrayBuffer\n      const decoder = new TextDecoder('utf-16le');\n      const jsonStr = decoder.decode(buffer); // 解码成字符串\n      const jsonData = JSON.parse(jsonStr); // 解析出 { name, input_x }\n\n      /* ---------- 2. 组装 multipart/form-data ---------- */\n      const form = new FormData();\n      form.append('data_json', JSON.stringify(jsonData)); // 字符串字段\n      form.append('tag_file', fileObj, fileObj.name); // 文件字段\n\n      /* ---------- 3. 发送请求 ---------- */\n      const {\n        data\n      } = await axios.post('/api/train', form, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      message.success('训练成功！');\n      setTrainingResult(data.parameters);\n      console.log('训练结果:', data);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error('训练失败:', err);\n      message.error(`训练失败: ${(err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.detail) || err.message}`);\n      setTrainingResult(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /** Ant Design Upload 配置 */\n  const uploadProps = {\n    accept: '.json',\n    maxCount: 1,\n    beforeUpload: file => {\n      selectedFileRef.current = file;\n      setFileName(file.name);\n      message.success(`${file.name} 已就绪，点击“开始训练”`);\n      return false; // 阻止自动上传\n    },\n    onRemove: () => {\n      selectedFileRef.current = null;\n      setFileName(null);\n      return true;\n    },\n    fileList: fileName ? [{\n      uid: '1',\n      name: fileName,\n      status: 'done',\n      originFileObj: selectedFileRef.current\n    }] : []\n  };\n  return /*#__PURE__*/_jsxDEV(Card, {\n    title: \"\\u53C2\\u6570\\u8BAD\\u7EC3\",\n    children: [/*#__PURE__*/_jsxDEV(Form, {\n      layout: \"vertical\",\n      children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n        label: \"\\u8BAD\\u7EC3\\u6570\\u636E\\u96C6 (JSON)\",\n        children: [/*#__PURE__*/_jsxDEV(Upload, {\n          ...uploadProps,\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            icon: /*#__PURE__*/_jsxDEV(UploadOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 78,\n              columnNumber: 27\n            }, this),\n            disabled: !!fileName,\n            children: \"\\u4E0A\\u4F20 Tag \\u6587\\u4EF6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }, this), fileName && /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\u5DF2\\u9009\\u62E9\\u6587\\u4EF6: \", fileName]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 24\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          onClick: onTrain,\n          loading: loading,\n          disabled: !fileName,\n          children: \"\\u5F00\\u59CB\\u8BAD\\u7EC3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this), trainingResult && /*#__PURE__*/_jsxDEV(Card, {\n      title: \"\\u8BAD\\u7EC3\\u7ED3\\u679C\",\n      style: {\n        marginTop: 20\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"\\u7B97\\u6CD5 Name:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 14\n        }, this), \" \", trainingResult.Name || trainingResult.tag || trainingResult.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"w:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 14\n        }, this), \" \", JSON.stringify(trainingResult.w)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"b:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 14\n        }, this), \" \", trainingResult.b]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 74,\n    columnNumber: 5\n  }, this);\n};\n_s(Training, \"Ooa7jZ4pIjfM0qaJ/JgHpEYA40E=\");\n_c = Training;\nexport default Training;\nvar _c;\n$RefreshReg$(_c, \"Training\");","map":{"version":3,"names":["React","useState","useRef","Form","Button","message","Card","Upload","UploadOutlined","axios","jsxDEV","_jsxDEV","Training","_s","loading","setLoading","trainingResult","setTrainingResult","selectedFileRef","fileName","setFileName","onTrain","fileObj","current","error","buffer","arrayBuffer","decoder","TextDecoder","jsonStr","decode","jsonData","JSON","parse","form","FormData","append","stringify","name","data","post","headers","success","parameters","console","log","err","_err$response","_err$response$data","response","detail","uploadProps","accept","maxCount","beforeUpload","file","onRemove","fileList","uid","status","originFileObj","title","children","layout","Item","label","icon","_jsxFileName","lineNumber","columnNumber","disabled","type","onClick","style","marginTop","Name","tag","w","b","_c","$RefreshReg$"],"sources":["D:/OneDrive/Little_Projects/Param-Fitter/frontend/src/pages/Training.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\r\nimport { Form, Button, message, Card, Upload } from 'antd';\r\nimport { UploadOutlined } from '@ant-design/icons';\r\nimport type { UploadRequestOption } from 'antd/lib/upload/interface'; \r\nimport type { RcFile } from 'antd/es/upload';\r\nimport axios from 'axios';\r\n\r\nconst Training: React.FC = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [trainingResult, setTrainingResult] = useState<any>(null);\r\n  const selectedFileRef = useRef<RcFile | null>(null);      // 选中的 Tag 文件\r\n  const [fileName, setFileName] = useState<string | null>(null);\r\n\r\n  /** 点击“开始训练” */\r\n  const onTrain = async () => {\r\n    const fileObj = selectedFileRef.current;\r\n    if (!fileObj) {\r\n      message.error('请先上传 Tag 文件');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      /* ---------- 1. 读取文件内容 (UTF-16LE → JSON) ---------- */\r\n      const buffer = await fileObj.arrayBuffer();           // 读成 ArrayBuffer\r\n      const decoder = new TextDecoder('utf-16le');\r\n      const jsonStr = decoder.decode(buffer);               // 解码成字符串\r\n      const jsonData = JSON.parse(jsonStr);                 // 解析出 { name, input_x }\r\n\r\n      /* ---------- 2. 组装 multipart/form-data ---------- */\r\n      const form = new FormData();\r\n      form.append('data_json', JSON.stringify(jsonData));   // 字符串字段\r\n      form.append('tag_file', fileObj, fileObj.name);       // 文件字段\r\n\r\n      /* ---------- 3. 发送请求 ---------- */\r\n      const { data } = await axios.post('/api/train', form, {\r\n        headers: { 'Content-Type': 'multipart/form-data' }\r\n      });\r\n\r\n      message.success('训练成功！');\r\n      setTrainingResult(data.parameters);\r\n      console.log('训练结果:', data);\r\n    } catch (err: any) {\r\n      console.error('训练失败:', err);\r\n      message.error(`训练失败: ${err?.response?.data?.detail || err.message}`);\r\n      setTrainingResult(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  /** Ant Design Upload 配置 */\r\n  const uploadProps: UploadProps = {\r\n    accept: '.json',\r\n    maxCount: 1,\r\n    beforeUpload: (file) => {\r\n      selectedFileRef.current = file;\r\n      setFileName(file.name);\r\n      message.success(`${file.name} 已就绪，点击“开始训练”`);\r\n      return false;                                        // 阻止自动上传\r\n    },\r\n    onRemove: () => {\r\n      selectedFileRef.current = null;\r\n      setFileName(null);\r\n      return true;\r\n    },\r\n    fileList: fileName\r\n      ? [{ uid: '1', name: fileName, status: 'done', originFileObj: selectedFileRef.current! }]\r\n      : [],\r\n  };\r\n\r\n  return (\r\n    <Card title=\"参数训练\">\r\n      <Form layout=\"vertical\">\r\n        <Form.Item label=\"训练数据集 (JSON)\">\r\n          <Upload {...uploadProps}>\r\n            <Button icon={<UploadOutlined />} disabled={!!fileName}>上传 Tag 文件</Button>\r\n          </Upload>\r\n          {fileName && <p>已选择文件: {fileName}</p>}\r\n        </Form.Item>\r\n        <Form.Item>\r\n          <Button type=\"primary\" onClick={onTrain} loading={loading} disabled={!fileName}>\r\n            开始训练\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n\r\n      {trainingResult && (\r\n        <Card title=\"训练结果\" style={{ marginTop: 20 }}>\r\n          <p><strong>算法 Name:</strong> {trainingResult.Name || trainingResult.tag || trainingResult.name}</p>\r\n          <p><strong>w:</strong> {JSON.stringify(trainingResult.w)}</p>\r\n          <p><strong>b:</strong> {trainingResult.b}</p>\r\n        </Card>\r\n      )}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default Training;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}