{"ast":null,"code":"var _jsxFileName = \"D:\\\\OneDrive\\\\Little_Projects\\\\Param-Fitter\\\\frontend\\\\src\\\\pages\\\\Training.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef } from 'react';\nimport { Card, Upload, Button, message } from 'antd';\nimport { UploadOutlined } from '@ant-design/icons';\n// v4 路径\n// ⭐ 新增 UploadProps & UploadFile\n\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Training = () => {\n  _s();\n  var _trainingResult$Name;\n  const [loading, setLoading] = useState(false);\n  const [trainingResult, setTrainingResult] = useState(null);\n  const selectedFileRef = useRef(null);\n  const [fileName, setFileName] = useState(null);\n\n  /* ---------- 点击“开始训练” ---------- */\n  const onTrain = async () => {\n    const fileObj = selectedFileRef.current;\n    if (!fileObj) {\n      message.error('请先上传 Tag 文件');\n      return;\n    }\n    setLoading(true);\n    try {\n      /* 1. 读取文件内容 → 自动识别编码 */\n      const buffer = await fileObj.arrayBuffer();\n      let jsonStr;\n      try {\n        jsonStr = new TextDecoder('utf-8').decode(buffer);\n        JSON.parse(jsonStr); // 若 UTF-8 能解析，不抛错\n      } catch {\n        jsonStr = new TextDecoder('utf-16le').decode(buffer);\n      }\n      const jsonData = JSON.parse(jsonStr); // { name, input_x }\n\n      /* 2. 组装 multipart/form-data */\n      const form = new FormData();\n      form.append('data_json', JSON.stringify(jsonData));\n      form.append('tag_file', fileObj, fileObj.name);\n\n      /* 3. 发送请求 */\n      const {\n        data\n      } = await axios.post('/api/train', form, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      message.success('训练成功！');\n      setTrainingResult(data.parameters);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      message.error(`训练失败: ${(err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.detail) || err.message}`);\n      setTrainingResult(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /* ---------- Upload 组件配置 ---------- */\n  const uploadProps = {\n    accept: '.json',\n    maxCount: 1,\n    customRequest: async option => {\n      // 只做本地选择，不自动上传\n      const {\n        file,\n        onSuccess\n      } = option;\n      selectedFileRef.current = file;\n      setFileName(file.name);\n      message.success(`${file.name} 已就绪，点击“开始训练”`);\n      onSuccess && onSuccess({}, {});\n    },\n    onRemove: () => {\n      selectedFileRef.current = null;\n      setFileName(null);\n      return true;\n    },\n    fileList: fileName ? [{\n      uid: '1',\n      name: fileName,\n      status: 'done',\n      // ⭐ 类型断言\n      originFileObj: selectedFileRef.current\n    }] : []\n  };\n\n  /* ---------- JSX ---------- */\n  return /*#__PURE__*/_jsxDEV(Card, {\n    title: \"\\u53C2\\u6570\\u8BAD\\u7EC3\",\n    children: [/*#__PURE__*/_jsxDEV(Upload, {\n      ...uploadProps,\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        icon: /*#__PURE__*/_jsxDEV(UploadOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 23\n        }, this),\n        disabled: !!fileName,\n        children: \"\\u4E0A\\u4F20 Tag \\u6587\\u4EF6\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this), fileName && /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        marginTop: 8\n      },\n      children: [\"\\u5DF2\\u9009\\u62E9\\u6587\\u4EF6: \", fileName]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 20\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      type: \"primary\",\n      onClick: onTrain,\n      loading: loading,\n      disabled: !fileName,\n      style: {\n        marginTop: 16\n      },\n      children: \"\\u5F00\\u59CB\\u8BAD\\u7EC3\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), trainingResult && /*#__PURE__*/_jsxDEV(Card, {\n      title: \"\\u8BAD\\u7EC3\\u7ED3\\u679C\",\n      style: {\n        marginTop: 24\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Name :\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 14\n        }, this), \" \", (_trainingResult$Name = trainingResult.Name) !== null && _trainingResult$Name !== void 0 ? _trainingResult$Name : trainingResult.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"w :\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 14\n        }, this), \" \", JSON.stringify(trainingResult.w)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"b :\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 14\n        }, this), \" \", trainingResult.b]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 5\n  }, this);\n};\n_s(Training, \"Ooa7jZ4pIjfM0qaJ/JgHpEYA40E=\");\n_c = Training;\nexport default Training;\nvar _c;\n$RefreshReg$(_c, \"Training\");","map":{"version":3,"names":["React","useState","useRef","Card","Upload","Button","message","UploadOutlined","axios","jsxDEV","_jsxDEV","Training","_s","_trainingResult$Name","loading","setLoading","trainingResult","setTrainingResult","selectedFileRef","fileName","setFileName","onTrain","fileObj","current","error","buffer","arrayBuffer","jsonStr","TextDecoder","decode","JSON","parse","jsonData","form","FormData","append","stringify","name","data","post","headers","success","parameters","err","_err$response","_err$response$data","response","detail","uploadProps","accept","maxCount","customRequest","option","file","onSuccess","onRemove","fileList","uid","status","originFileObj","title","children","icon","_jsxFileName","lineNumber","columnNumber","disabled","style","marginTop","type","onClick","Name","w","b","_c","$RefreshReg$"],"sources":["D:/OneDrive/Little_Projects/Param-Fitter/frontend/src/pages/Training.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\r\nimport { Card, Upload, Button, message } from 'antd';\r\nimport { UploadOutlined } from '@ant-design/icons';\r\nimport type { UploadRequestOption } from 'antd/lib/upload/interface';   // v4 路径\r\nimport type { UploadProps, UploadFile } from 'antd';                    // ⭐ 新增 UploadProps & UploadFile\r\nimport type { RcFile } from 'antd/es/upload';\r\nimport axios from 'axios';\r\n\r\nconst Training: React.FC = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [trainingResult, setTrainingResult] = useState<any>(null);\r\n  const selectedFileRef = useRef<RcFile | null>(null);\r\n  const [fileName, setFileName] = useState<string | null>(null);\r\n\r\n  /* ---------- 点击“开始训练” ---------- */\r\n  const onTrain = async () => {\r\n    const fileObj = selectedFileRef.current;\r\n    if (!fileObj) {\r\n      message.error('请先上传 Tag 文件');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      /* 1. 读取文件内容 → 自动识别编码 */\r\n      const buffer = await fileObj.arrayBuffer();\r\n      let jsonStr: string;\r\n\r\n      try {\r\n        jsonStr = new TextDecoder('utf-8').decode(buffer);\r\n        JSON.parse(jsonStr);                      // 若 UTF-8 能解析，不抛错\r\n      } catch {\r\n        jsonStr = new TextDecoder('utf-16le').decode(buffer);\r\n      }\r\n\r\n      const jsonData = JSON.parse(jsonStr);       // { name, input_x }\r\n\r\n      /* 2. 组装 multipart/form-data */\r\n      const form = new FormData();\r\n      form.append('data_json', JSON.stringify(jsonData));\r\n      form.append('tag_file', fileObj, fileObj.name);\r\n\r\n      /* 3. 发送请求 */\r\n      const { data } = await axios.post('/api/train', form, {\r\n        headers: { 'Content-Type': 'multipart/form-data' },\r\n      });\r\n\r\n      message.success('训练成功！');\r\n      setTrainingResult(data.parameters);\r\n    } catch (err: any) {\r\n      message.error(`训练失败: ${err?.response?.data?.detail || err.message}`);\r\n      setTrainingResult(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  /* ---------- Upload 组件配置 ---------- */\r\n  const uploadProps: UploadProps = {\r\n    accept: '.json',\r\n    maxCount: 1,\r\n    customRequest: async (option: UploadRequestOption) => {\r\n      // 只做本地选择，不自动上传\r\n      const { file, onSuccess } = option;\r\n      selectedFileRef.current = file as RcFile;\r\n      setFileName((file as RcFile).name);\r\n      message.success(`${file.name} 已就绪，点击“开始训练”`);\r\n      onSuccess && onSuccess({}, {} as any);\r\n    },\r\n    onRemove: () => {\r\n      selectedFileRef.current = null;\r\n      setFileName(null);\r\n      return true;\r\n    },\r\n    fileList: fileName\r\n      ? [{\r\n          uid: '1',\r\n          name: fileName,\r\n          status: 'done' as UploadFile['status'],     // ⭐ 类型断言\r\n          originFileObj: selectedFileRef.current!,\r\n        }]\r\n      : [],\r\n  };\r\n\r\n  /* ---------- JSX ---------- */\r\n  return (\r\n    <Card title=\"参数训练\">\r\n      <Upload {...uploadProps}>\r\n        <Button icon={<UploadOutlined />} disabled={!!fileName}>上传 Tag 文件</Button>\r\n      </Upload>\r\n      {fileName && <p style={{ marginTop: 8 }}>已选择文件: {fileName}</p>}\r\n\r\n      <Button\r\n        type=\"primary\"\r\n        onClick={onTrain}\r\n        loading={loading}\r\n        disabled={!fileName}\r\n        style={{ marginTop: 16 }}\r\n      >\r\n        开始训练\r\n      </Button>\r\n\r\n      {trainingResult && (\r\n        <Card title=\"训练结果\" style={{ marginTop: 24 }}>\r\n          <p><b>Name :</b> {trainingResult.Name ?? trainingResult.name}</p>\r\n          <p><b>w :</b> {JSON.stringify(trainingResult.w)}</p>\r\n          <p><b>b :</b> {trainingResult.b}</p>\r\n        </Card>\r\n      )}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default Training;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}